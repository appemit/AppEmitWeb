<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>证信签3.0测试页</title>
	<!--  调试IE
 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebug-lite/1.4.0/firebug-lite.js#startOpened"></script> 
	    <script src="https://cdn.jsdelivr.net/gh/appemit/AppEmitWeb@master/docs/firebug_1.4.js#startOpened"></script>
    -->
 
    <script>
 
	 //引入json2  解决IE10不支持JSON.stringify https://github.com/douglascrockford/JSON-js/blob/master/json2.js
    if(typeof JSON!=="object"){JSON={}}(function(){"use strict";var rx_one=/^[\],:{}\s]*$/;var rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g;var rx_four=/(?:^|:|,)(?:\s*\[)+/g;var rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function f(n){return(n<10)?"0"+n:n}function this_value(){return this.valueOf()}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?(this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z"):null};Boolean.prototype.toJSON=this_value;Number.prototype.toJSON=this_value;String.prototype.toJSON=this_value}var gap;var indent;var meta;var rep;function quote(string){rx_escapable.lastIndex=0;return rx_escapable.test(string)?"\""+string.replace(rx_escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+"\"":"\""+string+"\""}function str(key,holder){var i;var k;var v;var length;var mind=gap;var partial;var value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return(isFinite(value))?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?("[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]"):"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+((gap)?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+((gap)?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\"":"\\\"","\\":"\\\\"};JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else if(typeof space==="string"){indent=space}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify");}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k;var v;var value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);rx_dangerous.lastIndex=0;if(rx_dangerous.test(text)){text=text.replace(rx_dangerous,function(a){return("\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4))})}if(rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,""))){j=eval("("+text+")");return(typeof reviver==="function")?walk({"":j},""):j}throw new SyntaxError("JSON.parse");}}}());
	

	var mydll;

        function onLoadText() {
            mydll = new ActiveXObject("KrForDev.ID");
            //网页加载时启动ADB进程
            //mydll.StartADB();
            //mydll = document.getElementById("Connect");
        }

        function OpenPdf(filePath) {
		 
            try {
                 filePath =filePath || document.getElementById('inFile').value;
                // 打开本地文件
                // 参数1：本地文件路径  
                testWebObj.CloseFile();
                testWebObj.OpenLocalFile(filePath);
            } catch (e) {
                ShowExceptionError(e);
            }
        }

        function ClosePdf() {
            try {
                // 打开本地文件
                // 参数1：本地文件路径  
                testWebObj.CloseFile();
            } catch (e) {
                ShowExceptionError(e);
            }
        }

        function DisplayPage() {
            try {
                var url = "http://www.hebkr.com";
                mydll.SendUrl(url);
            } catch (e) {
                ShowExceptionError(e);
            }
        }

        function JudgePage() {
            try {
                //启动评价系统
                function jsCallbackFunc(a) {
                    alert(a);
                }
                mydll.GetGrade(jsCallbackFunc);
            } catch (e) {
                ShowExceptionError(e);
            }
        }

        function DoShare() {
            try {
                document.getElementById('btnShare').disabled = true;
                var err = mydll.StartScreenShare();
            } catch (e) {
                document.getElementById('btnShare').disabled = false;
                ShowExceptionError(e);
            }
        }

        function StopShare() {
            try {
                mydll.StopScreenShare();
                document.getElementById('btnShare').disabled = false;
            } catch (e) {
                ShowExceptionError(e);
            }
        }

        function exitADB() {
            try {
                mydll.StopADB();
            } catch (e) {
                ShowExceptionError(e);
            }
        }

        function findADB() {
            try {
                var err = mydll.ADBStates();
                if (err == 1) {
                    alert("ADB正在运行！");
                } else {
                    alert("ADB未运行！");
                }
            } catch (e) {
                ShowExceptionError(e);
            }
        }
     
	  function emitBack(){
	   
	   external.emitBack(JSON.stringify({"AppMark":"mark2","rid":"rid1","a":56,"b":"sdfsd"}))
	    external.runCmd("return {'temp':333}")
	   external.runCmd("return AppJsObject.web.addHeaders;")
	  }	
 
  	  function refresh(){
	 // external.go("http://www.baidu.com"); 
	   external.refresh()
	   
	  }
 
	  
	  /*
在这里调用IE网页内核的方法  ,通过external 调用
 go(url);//  headers为追加  IE url,headers,target,flags ， kit bkink(url)
 goBack()
 goForward()
 doScript(code,frame)  //IE(jscode,frame)   kit bkink(jscode)
 post(url,postdata,headers,target,flags)  IE (url,postdata,headers,target,flags) ， kit blink(url,postdata)
 refresh()   仅IE 刷新页面\n如果服务器未更新则不会重新下载,类似在浏览器中按F5的效果
 refresh2(lev=0)     仅IE  重新下载页面\n可在参数中指定级别  Refresh20
 refresh3(lev=3)   仅IE 重新下载最新页面\n添加Pragma:no-cache请求头,强制服务端刷新\n类似在浏览器中按下Ctrl+F5的效果    Refresh23
 reload()   重新下载最新页面= refresh3
 stop() 
 document() 
 script()
 getDoc()  可以包含document以及iframe
 click()
 */
    </script>
    <style>
        body {
            text-align: center
        }
        .div {
            margin: 0 auto;
            width: 800px;
            height: 500px;
            border: 1px solid #000
        }
    </style>
</head>
<body onload="onLoadText();">
<br/>
<div class="div">
   <object id="testWebObj" classid="CLSID:2D00EF02-07C5-4E46-BAF7-F69CAC129A83" width="100%" height="100%"></object> 
</div>
<input type="button" value="4反馈数据回首页" style="width:80px;" onclick="emitBack()"/>
 
<input type="button" value="刷新" style="width:80px;" onclick="refresh()"/>
<br/> PDF路径1：
<input id="inFile" type="file" maxlength="140" style="width:390px;"/>
<br/>
<br/>

<input type="button" value="打开文档"  id="IDOpenPdf" style="width:80px;" onclick="OpenPdf()"/>
<input type="button" value="关闭文档" style="width:80px;" onclick="ClosePdf()"/>
<!--<input type= "button"  value="结束ADB" style="width:80px;" onclick="exitADB()" > -->
<input type="button" value="ADB状态" style="width:80px;" onclick="findADB()">
<input type="button" value="发送URL" style="width:80px;" onclick="DisplayPage()"/>
<input type="button" value="评价系统" style="width:80px;" onclick="JudgePage()">
<input type="button" id="btnShare" value="屏幕共享" style="width:80px;" onclick="DoShare()"/>
<input type="button" value="结束共享" style="width:80px;" onclick="StopShare()"/>
<br/>
<div id="imagesdiv"></div>

<script language="javascript" for="testWebObj" event="OnHandSignCompleted(b)">
    if (b) {
        try {
            var infoJson = testWebObj.GetHandSignRecord();
            if (infoJson.length > 0) {
                document.getElementById("imagesdiv").innerHTML = "";
                var obj = JSON.parse(infoJson);
                for (i = 0; i < obj.length; i++) {
                    // 签字时间 时间戳
                    //obj[i]["signTime"]
                    var v = document.createElement("br");
                    document.getElementById("imagesdiv").appendChild(v);
                    var v = document.createElement("img");
                    // 签字图片
                    v.setAttribute('src', 'data:image/png;base64,' + obj[i]["signPic"]);
                    document.getElementById("imagesdiv").appendChild(v);
                    v = document.createElement("img");
                    // 指纹图片
                    v.setAttribute('src', 'data:image/png;base64,' + obj[i]["FPPic"]);
                    document.getElementById("imagesdiv").appendChild(v);
                    v = document.createElement("img");
                    // 合成后的图片
                    v.setAttribute('src', 'data:image/png;base64,' + obj[i]["CompPic"]);
                    document.getElementById("imagesdiv").appendChild(v);
                }
            }
        } catch (e) {
            ShowExceptionError(e);
        }
    }
</script>
</body>
</html>